import{get as j,set as C}from"./Storage-CjkH8JmZ.js";import{e as z}from"./index-BJx1k2uJ.js";var D=function(){function i(){}var r=i.prototype;return r.expandToken=function(e){for(var u=[],l="",d=0,f=e.length;d<f;++d)l+=e.charAt(d),u.push(l);return u},i}(),L=function(){function i(){}var r=i.prototype;return r.sanitize=function(e){return e?e.toLocaleLowerCase().trim():""},i}();function b(i,r){r=r||[],i=i||{};for(var t=i,e=0;e<r.length;e++)if(t=t[r[e]],t==null)return null;return t}var O=function(){function i(t){this._uidFieldName=t,this._tokenToIdfCache={},this._tokenMap={}}var r=i.prototype;return r.indexDocument=function(e,u,l){this._tokenToIdfCache={};var d=this._tokenMap,f;typeof d[e]!="object"?d[e]=f={$numDocumentOccurrences:0,$totalNumOccurrences:1,$uidMap:{}}:(f=d[e],f.$totalNumOccurrences++);var m=f.$uidMap;typeof m[u]!="object"?(f.$numDocumentOccurrences++,m[u]={$document:l,$numTokenOccurrences:1}):m[u].$numTokenOccurrences++},r.search=function(e,u){for(var l={},d=0,f=e.length;d<f;d++){var m=e[d],v=this._tokenMap[m];if(!v)return[];if(d===0)for(var o=Object.keys(v.$uidMap),c=0,s=o.length;c<s;c++){var n=o[c];l[n]=v.$uidMap[n].$document}else for(var o=Object.keys(l),c=0,s=o.length;c<s;c++){var n=o[c];typeof v.$uidMap[n]!="object"&&delete l[n]}}var a=[];for(var n in l)a.push(l[n]);var h=this._createCalculateTfIdf();return a.sort(function(p,_){return h(e,_,u)-h(e,p,u)})},r._createCalculateIdf=function(){var e=this._tokenMap,u=this._tokenToIdfCache;return function(d,f){if(!u[d]){var m=typeof e[d]<"u"?e[d].$numDocumentOccurrences:0;u[d]=1+Math.log(f.length/(1+m))}return u[d]}},r._createCalculateTfIdf=function(){var e=this._tokenMap,u=this._uidFieldName,l=this._createCalculateIdf();return function(f,m,v){for(var o=0,c=0,s=f.length;c<s;++c){var n=f[c],a=l(n,v);a===1/0&&(a=0);var h;u instanceof Array?h=m&&b(m,u):h=m&&m[u];var p=typeof e[n]<"u"&&typeof e[n].$uidMap[h]<"u"?e[n].$uidMap[h].$numTokenOccurrences:0;o+=p*a}return o}},i}(),H=/[^a-zа-яё0-9\-']+/i,N=function(){function i(){}var r=i.prototype;return r.tokenize=function(e){return e.split(H).filter(function(u){return u})},i}();function k(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}function F(i,r,t){return r&&k(i.prototype,r),t&&k(i,t),i}var S=function(){function i(t){if(!t)throw Error("js-search requires a uid field name constructor parameter");this._uidFieldName=t,this._indexStrategy=new D,this._searchIndex=new O(t),this._sanitizer=new L,this._tokenizer=new N,this._documents=[],this._searchableFields=[]}var r=i.prototype;return r.addDocument=function(e){this.addDocuments([e])},r.addDocuments=function(e){this._documents=this._documents.concat(e),this.indexDocuments_(e,this._searchableFields)},r.addIndex=function(e){this._searchableFields.push(e),this.indexDocuments_(this._documents,[e])},r.search=function(e){var u=this._tokenizer.tokenize(this._sanitizer.sanitize(e));return this._searchIndex.search(u,this._documents)},r.indexDocuments_=function(e,u){this._initialized=!0;for(var l=this._indexStrategy,d=this._sanitizer,f=this._searchIndex,m=this._tokenizer,v=this._uidFieldName,o=0,c=e.length;o<c;o++){var s=e[o],n;v instanceof Array?n=b(s,v):n=s[v];for(var a=0,h=u.length;a<h;a++){var p,_=u[a];if(_ instanceof Array?p=b(s,_):p=s[_],p!=null&&typeof p!="string"&&p.toString&&(p=p.toString()),typeof p=="string")for(var g=m.tokenize(d.sanitize(p)),y=0,w=g.length;y<w;y++)for(var $=g[y],I=l.expandToken($),x=0,M=I.length;x<M;x++){var E=I[x];f.indexDocument(E,n,s)}}}},F(i,[{key:"indexStrategy",set:function(e){if(this._initialized)throw Error("IIndexStrategy cannot be set after initialization");this._indexStrategy=e},get:function(){return this._indexStrategy}},{key:"sanitizer",set:function(e){if(this._initialized)throw Error("ISanitizer cannot be set after initialization");this._sanitizer=e},get:function(){return this._sanitizer}},{key:"searchIndex",set:function(e){if(this._initialized)throw Error("ISearchIndex cannot be set after initialization");this._searchIndex=e},get:function(){return this._searchIndex}},{key:"tokenizer",set:function(e){if(this._initialized)throw Error("ITokenizer cannot be set after initialization");this._tokenizer=e},get:function(){return this._tokenizer}}]),i}();function T(i,r,t){return i.replace(new RegExp(`(${r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")})`,"ig"),t)}(async()=>{const i=document.querySelector('input[type="file"]'),r=document.querySelector('input[type="search"]'),t=document.querySelector("select"),e=document.querySelector("#results"),u=document.querySelector("#stats");if(!i||!r||!t||!e||!u)throw new Error("could not find elements");let l=new S("id");const d=o=>{var c;try{const s=o.orderedItems.filter(a=>a.type==="Create"&&typeof a.object!="string"&&a.object.type==="Note").map(a=>({...a,object:{...a.object,alt:a.object.attachment.map(h=>h.name).join("|")}}));if(!s.length)throw new Error("could not find any posts, double check that your outbox file is correct");const n=((c=s[s.length-1])==null?void 0:c.object.published)||0;u.innerHTML=`${s.length} posts, latest: <time datatime="${n}">${new Date(n).toDateString()}</time>`,l=new S("id"),l.tokenizer={tokenize(a){return a.split(/\s/).filter(h=>h)}},l.addIndex(["object","content"]),l.addIndex(["object","summary"]),l.addIndex(["object","alt"]),l.addDocuments(s),C("outbox",o),r.value="",m()}catch(s){let n="unknown error";s instanceof Error&&(n=s.message),z("Failed to load outbox",s),e.innerHTML=`<li class="null error">Failed to load outbox: ${n||"unknown error"}</li>`}},f=(o,c)=>{const s=l.tokenizer.tokenize(c);let n=T(o,c,'<mark class="exact">$1</mark>');return s.forEach(a=>{n=T(n,a,"<mark>$1</mark>")}),n},m=()=>{try{const o=r.value;if(Array.from(e.children).forEach(n=>n.remove()),o.length<3){e.innerHTML='<li class="null">Search results will be displayed here</li>';return}const c=l.search(o);if(!c.length){e.innerHTML=`<li class="null">No results found for search "${o}"</li>`;return}const s=t.value;s==="latest first"?c.sort((n,a)=>a.published.localeCompare(n.published)):s==="oldest first"&&c.sort((n,a)=>n.published.localeCompare(a.published)),c.forEach(n=>{const a=document.createElement("li"),h=document.createElement("a");if(h.title="open original",h.href=n.object.id,h.target="_blank",h.rel="noreferrer nofollow noopener",a.innerHTML=f(n.object.content||"",o),n.object.attachment.forEach(_=>{const g=document.createElement("div");g.innerHTML=f(_.name||"",o)||"Media with no provided descriptive text",a.appendChild(g)}),n.object.summary){const _=document.createElement("details"),g=document.createElement("summary");g.innerHTML=f(n.object.summary||"",o),_.innerHTML=a.innerHTML,a.textContent="",_.prepend(g),_.open=!0,a.appendChild(_)}const p=document.createElement("time");p.textContent=new Date(n.object.published).toDateString(),p.dateTime=n.object.published,h.appendChild(p),a.prepend(h),e.appendChild(a)})}catch(o){let c="unknown error";o instanceof Error&&(c=o.message),z("Failed to search",o),e.innerHTML=`<li class="null error">Failed to search: ${c||"unknown error"}</li>`}},v=j("outbox");v&&d(v),i.addEventListener("change",async()=>{var s;const o=(s=i.files)==null?void 0:s[0];if(!o)return;const c=JSON.parse(await o.text());d(c)}),r.addEventListener("input",m),t.addEventListener("change",m)})();
