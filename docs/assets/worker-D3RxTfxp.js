(function(){"use strict";var T=function(){function r(){}var n=r.prototype;return n.expandToken=function(e){for(var i=[],c="",a=0,o=e.length;a<o;++a)c+=e.charAt(a),i.push(c);return i},r}(),$=function(){function r(){}var n=r.prototype;return n.sanitize=function(e){return e?e.toLocaleLowerCase().trim():""},r}();function g(r,n){n=n||[],r=r||{};for(var t=r,e=0;e<n.length;e++)if(t=t[n[e]],t==null)return null;return t}var M=function(){function r(t){this._uidFieldName=t,this._tokenToIdfCache={},this._tokenMap={}}var n=r.prototype;return n.indexDocument=function(e,i,c){this._tokenToIdfCache={};var a=this._tokenMap,o;typeof a[e]!="object"?a[e]=o={$numDocumentOccurrences:0,$totalNumOccurrences:1,$uidMap:{}}:(o=a[e],o.$totalNumOccurrences++);var u=o.$uidMap;typeof u[i]!="object"?(o.$numDocumentOccurrences++,u[i]={$document:c,$numTokenOccurrences:1}):u[i].$numTokenOccurrences++},n.search=function(e,i){for(var c={},a=0,o=e.length;a<o;a++){var u=e[a],v=this._tokenMap[u];if(!v)return[];if(a===0)for(var d=Object.keys(v.$uidMap),f=0,l=d.length;f<l;f++){var s=d[f];c[s]=v.$uidMap[s].$document}else for(var d=Object.keys(c),f=0,l=d.length;f<l;f++){var s=d[f];typeof v.$uidMap[s]!="object"&&delete c[s]}}var _=[];for(var s in c)_.push(c[s]);var p=this._createCalculateTfIdf();return _.sort(function(h,z){return p(e,z,i)-p(e,h,i)})},n._createCalculateIdf=function(){var e=this._tokenMap,i=this._tokenToIdfCache;return function(a,o){if(!i[a]){var u=typeof e[a]<"u"?e[a].$numDocumentOccurrences:0;i[a]=1+Math.log(o.length/(1+u))}return i[a]}},n._createCalculateTfIdf=function(){var e=this._tokenMap,i=this._uidFieldName,c=this._createCalculateIdf();return function(o,u,v){for(var d=0,f=0,l=o.length;f<l;++f){var s=o[f],_=c(s,v);_===1/0&&(_=0);var p;i instanceof Array?p=u&&g(u,i):p=u&&u[i];var h=typeof e[s]<"u"&&typeof e[s].$uidMap[p]<"u"?e[s].$uidMap[p].$numTokenOccurrences:0;d+=h*_}return d}},r}(),D=/[^a-zа-яё0-9\-']+/i,w=function(){function r(){}var n=r.prototype;return n.tokenize=function(e){return e.split(D).filter(function(i){return i})},r}();function x(r,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function b(r,n,t){return n&&x(r.prototype,n),t&&x(r,t),r}var C=function(){function r(t){if(!t)throw Error("js-search requires a uid field name constructor parameter");this._uidFieldName=t,this._indexStrategy=new T,this._searchIndex=new M(t),this._sanitizer=new $,this._tokenizer=new w,this._documents=[],this._searchableFields=[]}var n=r.prototype;return n.addDocument=function(e){this.addDocuments([e])},n.addDocuments=function(e){this._documents=this._documents.concat(e),this.indexDocuments_(e,this._searchableFields)},n.addIndex=function(e){this._searchableFields.push(e),this.indexDocuments_(this._documents,[e])},n.search=function(e){var i=this._tokenizer.tokenize(this._sanitizer.sanitize(e));return this._searchIndex.search(i,this._documents)},n.indexDocuments_=function(e,i){this._initialized=!0;for(var c=this._indexStrategy,a=this._sanitizer,o=this._searchIndex,u=this._tokenizer,v=this._uidFieldName,d=0,f=e.length;d<f;d++){var l=e[d],s;v instanceof Array?s=g(l,v):s=l[v];for(var _=0,p=i.length;_<p;_++){var h,z=i[_];if(z instanceof Array?h=g(l,z):h=l[z],h!=null&&typeof h!="string"&&h.toString&&(h=h.toString()),typeof h=="string")for(var k=u.tokenize(a.sanitize(h)),I=0,E=k.length;I<E;I++)for(var N=k[I],S=c.expandToken(N),y=0,j=S.length;y<j;y++){var A=S[y];o.indexDocument(A,s,l)}}}},b(r,[{key:"indexStrategy",set:function(e){if(this._initialized)throw Error("IIndexStrategy cannot be set after initialization");this._indexStrategy=e},get:function(){return this._indexStrategy}},{key:"sanitizer",set:function(e){if(this._initialized)throw Error("ISanitizer cannot be set after initialization");this._sanitizer=e},get:function(){return this._sanitizer}},{key:"searchIndex",set:function(e){if(this._initialized)throw Error("ISearchIndex cannot be set after initialization");this._searchIndex=e},get:function(){return this._searchIndex}},{key:"tokenizer",set:function(e){if(this._initialized)throw Error("ITokenizer cannot be set after initialization");this._tokenizer=e},get:function(){return this._tokenizer}}]),r}();const O={tokenize(r){return r.split(/\s/).filter(n=>n)}};let m;onmessage=r=>{const{id:n,fn:t,data:e}=r.data;let i;t==="setUid"?(m=new C(...e),m.tokenizer=O):i=m[t](...e),postMessage({id:n,data:i})}})();
