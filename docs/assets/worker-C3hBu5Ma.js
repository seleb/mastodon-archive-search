(function(){"use strict";var S=(function(){function r(){}var n=r.prototype;return n.expandToken=function(e){for(var i=[],s="",a=0,o=e.length;a<o;++a)s+=e.charAt(a),i.push(s);return i},r})(),T=(function(){function r(){}var n=r.prototype;return n.sanitize=function(e){return e?e.toLocaleLowerCase().trim():""},r})();function g(r,n){n=n||[],r=r||{};for(var t=r,e=0;e<n.length;e++)if(t=t[n[e]],t==null)return null;return t}var $=(function(){function r(t){this._uidFieldName=t,this._tokenToIdfCache={},this._tokenMap={}}var n=r.prototype;return n.indexDocument=function(e,i,s){this._tokenToIdfCache={};var a=this._tokenMap,o;typeof a[e]!="object"?a[e]=o={$numDocumentOccurrences:0,$totalNumOccurrences:1,$uidMap:{}}:(o=a[e],o.$totalNumOccurrences++);var u=o.$uidMap;typeof u[i]!="object"?(o.$numDocumentOccurrences++,u[i]={$document:s,$numTokenOccurrences:1}):u[i].$numTokenOccurrences++},n.search=function(e,i){for(var s={},a=0,o=e.length;a<o;a++){var u=e[a],v=this._tokenMap[u];if(!v)return[];if(a===0)for(var l=Object.keys(v.$uidMap),f=0,d=l.length;f<d;f++){var c=l[f];s[c]=v.$uidMap[c].$document}else for(var l=Object.keys(s),f=0,d=l.length;f<d;f++){var c=l[f];typeof v.$uidMap[c]!="object"&&delete s[c]}}var _=[];for(var c in s)_.push(s[c]);var p=this._createCalculateTfIdf();return _.sort(function(h,z){return p(e,z,i)-p(e,h,i)})},n._createCalculateIdf=function(){var e=this._tokenMap,i=this._tokenToIdfCache;return function(a,o){if(!i[a]){var u=typeof e[a]<"u"?e[a].$numDocumentOccurrences:0;i[a]=1+Math.log(o.length/(1+u))}return i[a]}},n._createCalculateTfIdf=function(){var e=this._tokenMap,i=this._uidFieldName,s=this._createCalculateIdf();return function(o,u,v){for(var l=0,f=0,d=o.length;f<d;++f){var c=o[f],_=s(c,v);_===1/0&&(_=0);var p;i instanceof Array?p=u&&g(u,i):p=u&&u[i];var h=typeof e[c]<"u"&&typeof e[c].$uidMap[p]<"u"?e[c].$uidMap[p].$numTokenOccurrences:0;l+=h*_}return l}},r})(),M=/[^a-zа-яё0-9\-']+/i,D=(function(){function r(){}var n=r.prototype;return n.tokenize=function(e){return e.split(M).filter(function(i){return i})},r})();function w(r,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function C(r,n,t){return n&&w(r.prototype,n),r}var b=(function(){function r(t){if(!t)throw Error("js-search requires a uid field name constructor parameter");this._uidFieldName=t,this._indexStrategy=new S,this._searchIndex=new $(t),this._sanitizer=new T,this._tokenizer=new D,this._documents=[],this._searchableFields=[]}var n=r.prototype;return n.addDocument=function(e){this.addDocuments([e])},n.addDocuments=function(e){this._documents=this._documents.concat(e),this.indexDocuments_(e,this._searchableFields)},n.addIndex=function(e){this._searchableFields.push(e),this.indexDocuments_(this._documents,[e])},n.search=function(e){var i=this._tokenizer.tokenize(this._sanitizer.sanitize(e));return this._searchIndex.search(i,this._documents)},n.indexDocuments_=function(e,i){this._initialized=!0;for(var s=this._indexStrategy,a=this._sanitizer,o=this._searchIndex,u=this._tokenizer,v=this._uidFieldName,l=0,f=e.length;l<f;l++){var d=e[l],c;v instanceof Array?c=g(d,v):c=d[v];for(var _=0,p=i.length;_<p;_++){var h,z=i[_];if(z instanceof Array?h=g(d,z):h=d[z],h!=null&&typeof h!="string"&&h.toString&&(h=h.toString()),typeof h=="string")for(var x=u.tokenize(a.sanitize(h)),I=0,A=x.length;I<A;I++)for(var E=x[I],k=s.expandToken(E),y=0,N=k.length;y<N;y++){var j=k[y];o.indexDocument(j,c,d)}}}},C(r,[{key:"indexStrategy",set:function(e){if(this._initialized)throw Error("IIndexStrategy cannot be set after initialization");this._indexStrategy=e},get:function(){return this._indexStrategy}},{key:"sanitizer",set:function(e){if(this._initialized)throw Error("ISanitizer cannot be set after initialization");this._sanitizer=e},get:function(){return this._sanitizer}},{key:"searchIndex",set:function(e){if(this._initialized)throw Error("ISearchIndex cannot be set after initialization");this._searchIndex=e},get:function(){return this._searchIndex}},{key:"tokenizer",set:function(e){if(this._initialized)throw Error("ITokenizer cannot be set after initialization");this._tokenizer=e},get:function(){return this._tokenizer}}]),r})();const O={tokenize(r){return r.replaceAll("&#39;","'").replaceAll("&apos;","'").replaceAll("&quot;",'"').replaceAll("&amp;","&").replaceAll("&lt;","<").replaceAll("&gt;",">").split(/\s/).filter(n=>n)}};let m;onmessage=r=>{const{id:n,fn:t,data:e}=r.data;let i;t==="setUid"?(m=new b(...e),m.tokenizer=O):i=m[t](...e),postMessage({id:n,data:i})}})();
